function Matrix(e,t,i,n,a,r,s,o,l){"array"===$.type(e)?this.elements=[+e[0],+e[2],+e[4],+e[1],+e[3],+e[5],0,0,1]:this.elements=[e,t,i,n,a,r,s||0,o||0,l||1]}function Vector(e,t,i){this.elements=[e,t,i]}function mimeFromArrayBuffer(e){var t=new DataView(e).getUint32(0,!1).toString(16),i="";switch(!0){case"89504e47"==t:i="image/png";break;case"47494638"==t:i="image/gif";break;case"424d"==t.slice(0,2):i="image/bmp";break;case"ffd8ffe0"==t:case"ffd8ffe1"==t:case"ffd8ffe2"==t:case"ffd8ffe3"==t:case"ffd8ffe8"==t:i="image/jpeg"}return i}function setMimeTypeInRawDataURL(e,t){return e.replace(/^data:base64/,"data:"+t+";base64")}var base64={};base64.PADCHAR="=",base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(t){var e=new Error("DOM Exception 5");return e.code=e.number=5,e.name=e.description="INVALID_CHARACTER_ERR",e.toString=function(){return"Error: "+e.name+": "+e.message},e}},base64.getbyte64=function(e,t){var i=base64.ALPHA.indexOf(e.charAt(t));if(i===-1)throw base64.makeDOMException();return i},base64.decode=function(e){e=""+e;var t,i,n,a=base64.getbyte64,r=e.length;if(0===r)return e;if(r%4!==0)throw base64.makeDOMException();t=0,e.charAt(r-1)===base64.PADCHAR&&(t=1,e.charAt(r-2)===base64.PADCHAR&&(t=2),r-=4);var s=[];for(i=0;i<r;i+=4)n=a(e,i)<<18|a(e,i+1)<<12|a(e,i+2)<<6|a(e,i+3),s.push(String.fromCharCode(n>>16,n>>8&255,255&n));switch(t){case 1:n=a(e,i)<<18|a(e,i+1)<<12|a(e,i+2)<<6,s.push(String.fromCharCode(n>>16,n>>8&255));break;case 2:n=a(e,i)<<18|a(e,i+1)<<12,s.push(String.fromCharCode(n>>16))}return s.join("")},base64.getbyte=function(e,t){var i=e.charCodeAt(t);if(i>255)throw base64.makeDOMException();return i},base64.encode=function(e){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var t,i,n=base64.PADCHAR,a=base64.ALPHA,r=base64.getbyte,s=[];e=""+e;var o=e.length-e.length%3;if(0===e.length)return e;for(t=0;t<o;t+=3)i=r(e,t)<<16|r(e,t+1)<<8|r(e,t+2),s.push(a.charAt(i>>18)),s.push(a.charAt(i>>12&63)),s.push(a.charAt(i>>6&63)),s.push(a.charAt(63&i));switch(e.length-o){case 1:i=r(e,t)<<16,s.push(a.charAt(i>>18)+a.charAt(i>>12&63)+n+n);break;case 2:i=r(e,t)<<16|r(e,t+1)<<8,s.push(a.charAt(i>>18)+a.charAt(i>>12&63)+a.charAt(i>>6&63)+n)}return s.join("")}(function(){function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),n=i.length,a=new ArrayBuffer(n),r=new Uint8Array(a),s=0;s<n;s++)r[s]=i.charCodeAt(s);return a}function i(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},i.send()}function a(e,n){function a(t){var i=r(t),a=s(t);e.exifdata=i||{},e.iptcdata=a||{},n&&n.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var o=t(e.src);a(o)}else if(/^blob\:/i.test(e.src)){var l=new FileReader;l.onload=function(e){a(e.target.result)},i(e.src,function(e){l.readAsArrayBuffer(e)})}else{var h=new XMLHttpRequest;h.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";a(h.response),h=null},h.open("GET",e.src,!0),h.responseType="arraybuffer",h.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var l=new FileReader;l.onload=function(e){u&&console.log("Got file of length "+e.target.result.byteLength),a(e.target.result)},l.readAsArrayBuffer(e)}}function r(e){var t=new DataView(e);if(u&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return u&&console.log("Not a valid JPEG"),!1;for(var i,n=2,a=e.byteLength;n<a;){if(255!=t.getUint8(n))return u&&console.log("Not a valid marker at offset "+n+", found: "+t.getUint8(n)),!1;if(i=t.getUint8(n+1),u&&console.log(i),225==i)return u&&console.log("Found 0xFFE1 marker"),d(t,n+4,t.getUint16(n+2)-2);n+=2+t.getUint16(n+2)}}function s(e){var t=new DataView(e);if(u&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return u&&console.log("Not a valid JPEG"),!1;for(var i=2,n=e.byteLength,a=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};i<n;){if(a(t,i)){var r=t.getUint8(i+7);r%2!==0&&(r+=1),0===r&&(r=4);var s=i+8+r,l=t.getUint16(i+6+r);return o(e,s,l)}i++}}function o(e,t,i){for(var n,a,r,s,o,l=new DataView(e),h={},d=t;d<t+i;)28===l.getUint8(d)&&2===l.getUint8(d+1)&&(s=l.getUint8(d+2),s in b&&(r=l.getInt16(d+3),o=r+5,a=b[s],n=c(l,d+5,r),h.hasOwnProperty(a)?h[a]instanceof Array?h[a].push(n):h[a]=[h[a],n]:h[a]=n)),d++;return h}function l(e,t,i,n,a){var r,s,o,l=e.getUint16(i,!a),c={};for(o=0;o<l;o++)r=i+12*o+2,s=n[e.getUint16(r,!a)],!s&&u&&console.log("Unknown tag: "+e.getUint16(r,!a)),c[s]=h(e,r,t,i,a);return c}function h(e,t,i,n,a){var r,s,o,l,h,d,u=e.getUint16(t+2,!a),f=e.getUint32(t+4,!a),m=e.getUint32(t+8,!a)+i;switch(u){case 1:case 7:if(1==f)return e.getUint8(t+8,!a);for(r=f>4?m:t+8,s=[],l=0;l<f;l++)s[l]=e.getUint8(r+l);return s;case 2:return r=f>4?m:t+8,c(e,r,f-1);case 3:if(1==f)return e.getUint16(t+8,!a);for(r=f>2?m:t+8,s=[],l=0;l<f;l++)s[l]=e.getUint16(r+2*l,!a);return s;case 4:if(1==f)return e.getUint32(t+8,!a);for(s=[],l=0;l<f;l++)s[l]=e.getUint32(m+4*l,!a);return s;case 5:if(1==f)return h=e.getUint32(m,!a),d=e.getUint32(m+4,!a),o=new Number(h/d),o.numerator=h,o.denominator=d,o;for(s=[],l=0;l<f;l++)h=e.getUint32(m+8*l,!a),d=e.getUint32(m+4+8*l,!a),s[l]=new Number(h/d),s[l].numerator=h,s[l].denominator=d;return s;case 9:if(1==f)return e.getInt32(t+8,!a);for(s=[],l=0;l<f;l++)s[l]=e.getInt32(m+4*l,!a);return s;case 10:if(1==f)return e.getInt32(m,!a)/e.getInt32(m+4,!a);for(s=[],l=0;l<f;l++)s[l]=e.getInt32(m+8*l,!a)/e.getInt32(m+4+8*l,!a);return s}}function c(e,t,i){var a="";for(n=t;n<t+i;n++)a+=String.fromCharCode(e.getUint8(n));return a}function d(e,t){if("Exif"!=c(e,t,4))return u&&console.log("Not valid EXIF data! "+c(e,t,4)),!1;var i,n,a,r,s,o=t+6;if(18761==e.getUint16(o))i=!1;else{if(19789!=e.getUint16(o))return u&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=e.getUint16(o+2,!i))return u&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=e.getUint32(o+4,!i);if(h<8)return u&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(o+4,!i)),!1;if(n=l(e,o,o+h,g,i),n.ExifIFDPointer){r=l(e,o,o+n.ExifIFDPointer,p,i);for(a in r){switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":r[a]=w[a][r[a]];break;case"ExifVersion":case"FlashpixVersion":r[a]=String.fromCharCode(r[a][0],r[a][1],r[a][2],r[a][3]);break;case"ComponentsConfiguration":r[a]=w.Components[r[a][0]]+w.Components[r[a][1]]+w.Components[r[a][2]]+w.Components[r[a][3]]}n[a]=r[a]}}if(n.GPSInfoIFDPointer){s=l(e,o,o+n.GPSInfoIFDPointer,v,i);for(a in s){switch(a){case"GPSVersionID":s[a]=s[a][0]+"."+s[a][1]+"."+s[a][2]+"."+s[a][3]}n[a]=s[a]}}return n}var u=!1,f=this,m=function(e){return e instanceof m?e:this instanceof m?void(this.EXIFwrapped=e):new m(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports.EXIF=m):f.EXIF=m;var p=m.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},g=m.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=m.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},w=m.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},b={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};m.getData=function(t,i){return!((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete)&&(e(t)?i&&i.call(t):a(t,i),!0)},m.getTag=function(t,i){if(e(t))return t.exifdata[i]},m.getAllTags=function(t){if(!e(t))return{};var i,n=t.exifdata,a={};for(i in n)n.hasOwnProperty(i)&&(a[i]=n[i]);return a},m.pretty=function(t){if(!e(t))return"";var i,n=t.exifdata,a="";for(i in n)n.hasOwnProperty(i)&&(a+="object"==typeof n[i]?n[i]instanceof Number?i+" : "+n[i]+" ["+n[i].numerator+"/"+n[i].denominator+"]\r\n":i+" : ["+n[i].length+" values]\r\n":i+" : "+n[i]+"\r\n");return a},m.readFromBinaryFile=function(e){return r(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return m})}.call(this)),function(e){e.fn.uploaderImageList=function(t){function i(){this.addClass("imageList").add(this.images).addSubstitute()}t=t||{};var n=e.extend({images:[],maxImages:8,apiURI:"",preset:"ads",imageURL:function(e){return e},$mainImage:null,supported:!0,isMobile:!1,isLogo:!1},t);return e.extend(this,n),this.addSubstitute=function(){var t=this;switch(!0){case this.isMobile:if(this.maxImages!=this.images.length){var i=e("<div>").addClass("substitute").click(function(){t.parent().find("#download").click()});1==this.maxImages&&i.addClass("oneImage"),this.append(i)}break;case this.isLogo:this.append(e("<div>").addClass("substitute").click(function(){t.parent().find("#download").click()}));break;default:for(var n=1;n<=this.maxImages-this.images.length;n++)this.append(e("<div>").addClass("substitute").click(function(){t.parent().find("#download").click()}))}return this},this.add=function(t){function i(t){var i=this;if(1!=this.maxImages||this.isLogo||(this.images=[]),this.images.length<this.maxImages){var n=e("<div>").uploaderThumbnail({deleteCallback:function(){i.isMobile||i.isLogo||this==i.$mainImage.thumbnail()&&i.selectImage(i.getNextImage(this)),i.removeImage(this)},setDefaultCallback:function(){i.defaultImage(this)},clickCallback:function(){i.selectImage(this)},imageURL:this.imageURL,apiURI:this.apiURI,supported:i.supported,preset:this.preset,isMobile:this.isMobile,isLogo:this.isLogo}),a=!i.images.length;switch(i.images.push(n),!0){case i.isMobile:n.insertBefore(e(".substitute",i)),i.maxImages==i.images.length&&e(".substitute",i).remove();break;case i.isLogo:e(".substitute",i).remove(),n.appendTo(i);break;default:n.insertBefore(e(".substitute:first",i)),e(".substitute:first",i).remove()}n.addClass("loading"),navigator.userAgent.search(/Android|Mac OS/)>-1&&n.isImageURLLocal(t)?i.clearExifData(t,function(e){n.filename(e,function(){a&&(i.defaultImage(n),i.selectImage(n))})}):n.filename(t,function(){a&&(i.defaultImage(n),i.selectImage(n))})}return this}function n(t){var n=this;return e.each(t,function(){i.call(n,this)}),this}return n.call(this,[].concat(t))},this.clearExifData=function(t,i){var n=new Image;e(n).one("load",function(){EXIF.getData(this);var a=e("<canvas>"),r=a[0].getContext("2d");switch(e.inArray(this.exifdata.Orientation,[3,6,8])>-1?a.attr({width:this.height,height:this.width}):a.attr({width:this.width,height:this.height}),this.exifdata.Orientation){case 2:r.transform(-1,0,0,1,this.width,0);break;case 3:r.transform(-1,0,0,-1,this.width,this.height);break;case 4:r.transform(1,0,0,-1,0,this.height);break;case 5:r.transform(0,1,1,0,0,0);break;case 6:r.transform(0,1,-1,0,this.height,0);break;case 7:r.transform(0,-1,-1,0,this.height,this.width);break;case 8:r.transform(0,-1,1,0,0,this.width);break;default:return void i(t)}r.drawImage(n,0,0),r.transform(1,0,0,1,0,0),i(a[0].toDataURL("image/jpeg",1))}),n.src=t},this.selectImage=function(t){this.isMobile||this.isLogo||("undefined"==typeof window.HTMLCanvasElement&&this.$mainImage.thumbnail(t),this.$mainImage.thumbnail(t),e.each(this.images,function(){this.removeClass("selected")}),null!=t&&t.addClass("selected"))},this.defaultImage=function(t){function i(){var t;return e.each(this.images,function(){return!this.defaultImage()||(t=this,!1)}),t}function n(t){e.each(this.images,function(){this.defaultImage(!1)}),t.defaultImage(!0)}if(!this.isMobile&&!this.isLogo)return"undefined"==typeof t?i.call(this):(n.call(this,t),this)},this.getImageFilenames=function(t){t=t||!1;var i=[];return e(this.images).each(function(){var e=this.filename();t||this.isImageURLLocal(e)||(e=e.match(/(^|\/)([a-f0-9_]+(\.jpg|\.jpeg|\.gif|\.png))$/,"")[2]),this.defaultImage()?i.unshift(e):i.push(e)}),i},this.getModifiedImages=function(){return e.makeArray(e(this.images).filter(function(){return this.isModified()}))},this.getIndex=function(t){var i=-1;return e.each(this.images,function(e,n){t==n&&(i=e)}),i},this.getNextImage=function(e){var t=this.getIndex(e);return 1==this.images.length?null:(t<this.images.length-1?t++:t=0,this.images[t])},this.removeImage=function(t){var i=t.defaultImage(),n=this.getIndex(t),a=this;switch(this.removeImageByIndex(n),i&&this.images.length&&this.defaultImage(this.images[0]),!0){case this.isMobile:case this.isLogo:e(".substitute",this).size()||this.addSubstitute();break;default:this.append(e("<div>").addClass("substitute").click(function(){a.parent().find("#download").click()}))}return this},this.empty=function(){return e.each(this.images,function(e,t){t.remove()}),this.images=[],this},this.removeImageByIndex=function(e){return e>=0&&(this.images[e].remove(),this.images.splice(e,1)),this},i.call(this),this}}(jQuery),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],function(i){return t(e,i)}):"object"==typeof exports?t(e,require("jquery")):t(e,e.jQuery)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function i(e,t){for(var i=e.length;--i;)if(+e[i]!==+t[i])return!1;return!0}function n(e){var i={range:!0,animate:!0};return"boolean"==typeof e?i.animate=e:t.extend(i,e),i}function a(e,i,n,a,r,s,o,l,h){"array"===t.type(e)?this.elements=[+e[0],+e[2],+e[4],+e[1],+e[3],+e[5],0,0,1]:this.elements=[e,i,n,a,r,s,o||0,l||0,h||1]}function r(e,t,i){this.elements=[e,t,i]}function s(e,i){if(!(this instanceof s))return new s(e,i);1!==e.nodeType&&t.error("Panzoom called on non-Element node"),t.contains(d,e)||t.error("Panzoom element must be attached to the document");var n=t.data(e,u);if(n)return n;this.options=i=t.extend({},s.defaults,i),this.elem=e;var a=this.$elem=t(e);this.$set=i.$set&&i.$set.length?i.$set:a,this.$doc=t(e.ownerDocument||d),this.$parent=a.parent(),this.isSVG=v.test(e.namespaceURI)&&"svg"!==e.nodeName.toLowerCase(),this.panning=!1,this._buildTransform(),this._transform=!this.isSVG&&t.cssProps.transform.replace(g,"-$1").toLowerCase(),this._buildTransition(),this.resetDimensions();var r=t(),o=this;t.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(e,t){o[t]=i[t]||r}),this.enable(),t.data(e,u,this)}var o="over out down up move enter leave cancel".split(" "),l=t.extend({},t.event.mouseHooks),h={};if(e.PointerEvent)t.each(o,function(e,i){t.event.fixHooks[h[i]="pointer"+i]=l});else{var c=l.props;l.props=c.concat(["touches","changedTouches","targetTouches","altKey","ctrlKey","metaKey","shiftKey"]),l.filter=function(e,t){var i,n=c.length;if(!t.pageX&&t.touches&&(i=t.touches[0]))for(;n--;)e[c[n]]=i[c[n]];return e},t.each(o,function(e,i){if(e<2)h[i]="mouse"+i;else{var n="touch"+("down"===i?"start":"up"===i?"end":i);t.event.fixHooks[n]=l,h[i]=n+" mouse"+i}})}t.pointertouch=h;var d=e.document,u="__pz__",f=Array.prototype.slice,m=!!e.PointerEvent,p=function(){var e=d.createElement("input");return e.setAttribute("oninput","return"),"function"==typeof e.oninput}(),g=/([A-Z])/g,v=/^http:[\w\.\/]+svg$/,w="(\\-?[\\d\\.e]+)",b="\\,?\\s*",y=new RegExp("^matrix\\("+w+b+w+b+w+b+w+b+w+b+w+"\\)$");return a.prototype={x:function(e){var t=e instanceof r,i=this.elements,n=e.elements;return t&&3===n.length?new r(i[0]*n[0]+i[1]*n[1]+i[2]*n[2],i[3]*n[0]+i[4]*n[1]+i[5]*n[2],i[6]*n[0]+i[7]*n[1]+i[8]*n[2]):n.length===i.length&&new a(i[0]*n[0]+i[1]*n[3]+i[2]*n[6],i[0]*n[1]+i[1]*n[4]+i[2]*n[7],i[0]*n[2]+i[1]*n[5]+i[2]*n[8],i[3]*n[0]+i[4]*n[3]+i[5]*n[6],i[3]*n[1]+i[4]*n[4]+i[5]*n[7],i[3]*n[2]+i[4]*n[5]+i[5]*n[8],i[6]*n[0]+i[7]*n[3]+i[8]*n[6],i[6]*n[1]+i[7]*n[4]+i[8]*n[7],i[6]*n[2]+i[7]*n[5]+i[8]*n[8])},inverse:function(){var e=1/this.determinant(),t=this.elements;return new a(e*(t[8]*t[4]-t[7]*t[5]),e*-(t[8]*t[1]-t[7]*t[2]),e*(t[5]*t[1]-t[4]*t[2]),e*-(t[8]*t[3]-t[6]*t[5]),e*(t[8]*t[0]-t[6]*t[2]),e*-(t[5]*t[0]-t[3]*t[2]),e*(t[7]*t[3]-t[6]*t[4]),e*-(t[7]*t[0]-t[6]*t[1]),e*(t[4]*t[0]-t[3]*t[1]))},determinant:function(){var e=this.elements;return e[0]*(e[8]*e[4]-e[7]*e[5])-e[3]*(e[8]*e[1]-e[7]*e[2])+e[6]*(e[5]*e[1]-e[4]*e[2])}},r.prototype.e=a.prototype.e=function(e){return this.elements[e]},s.rmatrix=y,s.events=t.pointertouch,s.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,increment:.3,minScale:.4,maxScale:5,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},s.prototype={constructor:s,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),t.removeData(this.elem,u)},resetDimensions:function(){var e=this.$parent;this.container={width:e.innerWidth(),height:e.innerHeight()};var i,n=e.offset(),a=this.elem,r=this.$elem;this.isSVG?(i=a.getBoundingClientRect(),i={left:i.left-n.left,top:i.top-n.top,width:i.width,height:i.height,margin:{left:0,top:0}}):i={left:t.css(a,"left",!0)||0,top:t.css(a,"top",!0)||0,width:r.innerWidth(),height:r.innerHeight(),margin:{top:t.css(a,"marginTop",!0)||0,left:t.css(a,"marginLeft",!0)||0}},i.widthBorder=t.css(a,"borderLeftWidth",!0)+t.css(a,"borderRightWidth",!0)||0,i.heightBorder=t.css(a,"borderTopWidth",!0)+t.css(a,"borderBottomWidth",!0)||0,this.dimensions=i},reset:function(e){e=n(e);var t=this.setMatrix(this._origTransform,e);e.silent||this._trigger("reset",t)},resetZoom:function(e){e=n(e);var t=this.getMatrix(this._origTransform);e.dValue=t[3],this.zoom(t[0],e)},resetPan:function(e){var t=this.getMatrix(this._origTransform);this.pan(t[4],t[5],n(e))},setTransform:function(e){for(var i=this.isSVG?"attr":"style",n=this.$set,a=n.length;a--;)t[i](n[a],"transform",e)},getTransform:function(e){var i=this.$set,n=i[0];return e?this.setTransform(e):e=t[this.isSVG?"attr":"style"](n,"transform"),"none"===e||y.test(e)||this.setTransform(e=t.css(n,"transform")),e||"none"},getMatrix:function(e){var t=y.exec(e||this.getTransform());return t&&t.shift(),t||[1,0,0,1,0,0]},setMatrix:function(e,t){function i(e,t,i){var n=i,a=t;return t<i&&(n=a=(t+i)/2),Math.min(Math.max(n,e),a)}if(!this.disabled){t||(t={}),"string"==typeof e&&(e=this.getMatrix(e));var n,a,r,s,o=Math.abs(+e[0]?e[0]:e[1]);this.$parent,"undefined"!=typeof t.contain?t.contain:this.options.contain;n=this._checkDims(),a=this.container,r=+e[0]?n.width:n.height,s=+e[0]?n.height:n.width;var l={x:n.width/2,y:n.height/2},h={width:r*o,height:s*o},c={xmin:-l.x+h.width/2,ymin:-l.y+h.height/2,xmax:-l.x+a.width-h.width/2,ymax:-l.y+a.height-h.height/2};e[4]=i(e[4],c.xmin,c.xmax),e[5]=i(e[5],c.ymin,c.ymax);return"skip"!==t.animate&&this.transition(!t.animate),t.range&&this.$zoomRange.val(o),this.setTransform("matrix("+e.join(",")+")"),t.silent||this._trigger("change",e),e}},isPanning:function(){return this.panning},transition:function(e){if(this._transition)for(var i=e||!this.options.transition?"none":this._transition,n=this.$set,a=n.length;a--;)t.style(n[a],"transition")!==i&&t.style(n[a],"transition",i)},pan:function(e,t,i){if(!this.options.disablePan){i||(i={});var n=i.matrix;n||(n=this.getMatrix()),i.relative&&(e+=+n[4],t+=+n[5]),n[4]=e,n[5]=t,this.setMatrix(n,i),i.silent||this._trigger("pan",n[4],n[5])}},zoom:function(e,i){"object"==typeof e?(i=e,e=null):i||(i={});var n=t.extend({},this.options,i);if(!n.disableZoom){var s=!1,o=n.matrix||this.getMatrix(),l=Math.abs(+o[0]?o[0]:o[1]);"number"!=typeof e&&(e=+l+n.increment*(e?-1:1),s=!0),Math.abs(e)>n.maxScale?e=n.maxScale:Math.abs(e)<n.minScale&&(e=n.minScale);var h=n.focal;if(h&&!n.disablePan){var c=this._checkDims(),d=h.clientX,u=h.clientY;this.isSVG||(d-=(c.width+c.widthBorder)/2,u-=(c.height+c.heightBorder)/2);var f=new r(d,u,1),m=new a(o),p=this.parentOffset||this.$parent.offset(),g=new a(1,0,p.left-this.$doc.scrollLeft(),0,1,p.top-this.$doc.scrollTop()),v=m.inverse().x(g.inverse().x(f)),w=e/l;m=m.x(new a([w,0,0,w,0,0])),f=g.x(m.x(v)),o[4]=+o[4]+(d-f.e(0)),o[5]=+o[5]+(u-f.e(1))}for(var b=0;b<=3;b++)o[b]=+o[b]?e*o[b]/Math.abs(o[b]):0;this.setMatrix(o,{animate:"boolean"==typeof n.animate?n.animate:s,range:!n.noSetRange}),n.silent||this._trigger("zoom",e,n)}},option:function(e,i){var n;if(!e)return t.extend({},this.options);if("string"==typeof e){if(1===arguments.length)return void 0!==this.options[e]?this.options[e]:null;n={},n[e]=i}else n=e;this._setOptions(n)},_setOptions:function(e){t.each(e,t.proxy(function(e,i){switch(e){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}switch(this.options[e]=i,e){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[e]=i;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":t.style(this.elem,"cursor",i);break;case"minScale":this.$zoomRange.attr("min",i);break;case"maxScale":this.$zoomRange.attr("max",i);break;case"rangeStep":this.$zoomRange.attr("step",i);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"$set":i instanceof t&&i.length&&(this.$set=i,this._initStyle(),this._buildTransform())}},this))},_initStyle:function(){var e={"backface-visibility":"hidden","transform-origin":this.isSVG?"0 0":"50% 50%"};this.options.disablePan||(e.cursor=this.options.cursor),this.$set.css(e);var i=this.$parent;i.length&&!t.nodeName(i[0],"body")&&(e={overflow:"hidden"},"static"===i.css("position")&&(e.position="relative"),i.css(e))},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var e=this,i=this.options,n=i.eventNamespace,a=m?"pointerdown"+n:"touchstart"+n+" mousedown"+n,r=m?"pointerup"+n:"touchend"+n+" click"+n,o={},l=this.$reset,h=this.$zoomRange;if(t.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var e=i["on"+this];t.isFunction(e)&&(o["panzoom"+this.toLowerCase()+n]=e)}),i.disablePan&&i.disableZoom||(o[a]=function(t){var n;("touchstart"===t.type?!(n=t.touches)||(1!==n.length||i.disablePan)&&2!==n.length:i.disablePan||1!==t.which)||(t.preventDefault(),t.stopPropagation(),e._startMove(t,n))}),this.$elem.on(o),l.length&&l.on(r,function(t){t.preventDefault(),e.reset()}),h.length&&h.attr({step:i.rangeStep===s.defaults.rangeStep&&h.attr("step")||i.rangeStep,min:i.minScale,max:i.maxScale}).prop({value:this.getMatrix()[0]}),!i.disableZoom){var c=this.$zoomIn,d=this.$zoomOut;c.length&&d.length&&(c.on(r,function(t){t.preventDefault(),e.zoom(!!t.shiftKey&&{increment:i.increment/4})}),d.on(r,function(t){t.preventDefault(),e.zoom(!t.shiftKey||{increment:-i.increment/4})})),h.length&&(o={},o[(m?"pointerdown":"mousedown")+n]=function(){e.transition(!0)},o[(p?"input":"change")+n]=function(){e.zoom(+this.value,{noSetRange:!0})},h.on(o))}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){if(this._transform){var e=this.options;this._transition=this._transform+" "+e.duration+"ms "+e.easing}},_checkDims:function(){var e=this.dimensions;return e.width&&e.height||this.resetDimensions(),this.dimensions},_getDistance:function(e){var t=e[0],i=e[1];return Math.sqrt(Math.pow(Math.abs(i.clientX-t.clientX),2)+Math.pow(Math.abs(i.clientY-t.clientY),2))},_getMiddle:function(e){var t=e[0],i=e[1];return{clientX:(i.clientX-t.clientX)/2+t.clientX,clientY:(i.clientY-t.clientY)/2+t.clientY}},_trigger:function(e){"string"==typeof e&&(e="panzoom"+e),this.$elem.triggerHandler(e,[this].concat(f.call(arguments,1)))},_startMove:function(e,n){var a,r,s,o,l,h,c,d,u=this,f=this.options,p=f.eventNamespace,g=this.getMatrix(),v=g.slice(0),w=+v[4],b=+v[5],y={matrix:g,animate:"skip"};m?(r="pointermove",s="pointerup"):"touchstart"===e.type?(r="touchmove",s="touchend"):(r="mousemove",s="mouseup"),r+=p,s+=p,this.transition(!0),this.panning=!0,this._trigger("start",e,n),n&&2===n.length?(o=this._getDistance(n),l=+Math.abs(+g[0]?g[0]:g[1]),h=this._getMiddle(n),a=function(e){e.preventDefault();var t=u._getMiddle(n=e.touches),i=u._getDistance(n)-o;u.zoom(i*(f.increment/100)+l,{focal:t,matrix:g,animate:!1}),u.pan(+g[4]+t.clientX-h.clientX,+g[5]+t.clientY-h.clientY,y),h=t}):(c=e.pageX,d=e.pageY,a=function(e){e.preventDefault(),u.pan(w+e.pageX-c,b+e.pageY-d,y)}),t("body").off(p).on(s,function(e){e.preventDefault(),t(this).off(p),u.panning=!1,e.type="panzoomend",u._trigger(e,g,!i(g,v))}).on(r,a)}},t.Panzoom=s,t.fn.panzoom=function(e){var i,n,a,r;return"string"==typeof e?(r=[],n=f.call(arguments,1),this.each(function(){i=t.data(this,u),i?"_"!==e.charAt(0)&&"function"==typeof(a=i[e])&&void 0!==(a=a.apply(i,n))&&r.push(a):r.push(void 0)}),r.length?1===r.length?r[0]:r:this):this.each(function(){new s(this,e)})},s}),function(e){e.fn.uploaderMainImage=function(t){function i(){this.addClass("mainImage empty"),a.call(this),this.supported&&(r.call(this),s.call(this),n.call(this))}function n(){f=u&&+u[0]?this.width():this.height(),m=u&&+u[0]?this.height():this.width()}function a(){h=e("<div></div>").addClass("block"),l=e("<img>").css({"background-color":"white"}),h.prepend(l),this.prepend(h)}function r(){switch(this.preset){case"PosterVenue":c=e("<div></div>").addClass("controls"),c.append(e("<div></div>").addClass("hint--left").attr("data-hint","Повернуть налево").append(e("<div></div>").addClass("rotateLeft"))).append(e("<div></div>").addClass("hint--left").attr("data-hint","Повернуть направо").append(e("<div></div>").addClass("rotateRight"))).append(e("<div></div>").addClass("hint--left").attr("data-hint","Удалить").append(e("<div></div>").addClass("delete"))),this.append(c);break;case"TVChannel":case"Logo":break;default:c=e("<div></div>").addClass("controls"),c.append(e("<div></div>").addClass("hint--left").attr("data-hint","Повернуть налево").append(e("<div></div>").addClass("rotateLeft"))).append(e("<div></div>").addClass("hint--left").attr("data-hint","Повернуть направо").append(e("<div></div>").addClass("rotateRight"))).append(e("<div></div>").addClass("hint--left").attr("data-hint","Увеличить").append(e("<div></div>").addClass("increaseImg"))).append(e("<div></div>").addClass("hint--left").attr("data-hint","Уменьшить").append(e("<div></div>").addClass("decreaseImg"))).append(e("<div></div>").addClass("hint--left").attr("data-hint","Удалить").append(e("<div></div>").addClass("delete"))),
this.append(c)}}function s(){var t=this;e(this).click(function(){e(this).parent().find("#download").click()}),e(".delete",this).click(function(e){e.stopPropagation(),d.deleteCallback.call(d),null==d&&l.width(0).height(0)}),e(".default",this).click(function(){d.setDefaultCallback.call(d),d.clickCallback.call(d)}),e(".rotateLeft",this).click(function(){t.rotate.call(t,[0,-1,1,0,0,0])}),e(".rotateRight",this).click(function(){t.rotate.call(t,[0,1,-1,0,0,0])}),l.load(function(){t.fit.call(t,l)})}function o(t,i){var n=!0;return e.each(t,function(e,t){if(+t!=+i[e])return n=!1,!0}),n}var l,h,c,d,u,f,m,p=e.extend({imageURL:function(e){return e},supported:!0,preset:"ads"},t);return e.extend(this,{isModified:function(){return!o(d.initialMatrix(),l.panzoom("getMatrix"))},fit:function(e){var t=e.width(),i=e.height(),n=Math.min(f/t,m/i);e.panzoom("resetDimensions"),e.panzoom("option","minScale",n),this.matrix()?e.panzoom("setMatrix",this.matrix()):(e.panzoom("setMatrix",[1,0,0,1,0,0]),e.panzoom("zoom",n),e.panzoom("pan",-(t-f)/2,-(i-m)/2))},thumbnail:function(e){var t,i=this;return"undefined"==typeof e?d:(l.css({width:"auto",height:"auto"}),this.applyModified(d),d=e,null==e?(l.attr("src",""),l.css({width:"0",height:"0"}),this.addClass("empty").click(function(){i.parent().find("#download").click()}),!1):(this.removeClass("empty").unbind("click"),t=e.filename(),d.matrix()&&i.matrix(d.matrix()),preview.prototype.setImageURL(l,t,function(){i.fit(l)}),l))},matrix:function(e){return"undefined"==typeof e?u:(u=e,n.call(this),l)},applyModified:function(e){if(e&&this.isModified()){var t;switch(this.preset){case"AdCommon":case"MarketProduct":t=previewSquareSmall;break;default:t=previewSmall}e.matrix(l.panzoom("getMatrix")),t.build(e.filename(),l.panzoom("getMatrix"),!1,e.width()/this.width(),function(t){e.image(t)})}if("undefined"==typeof window.HTMLCanvasElement){var i,n,a=l;a.css({width:"",height:""}),i=a.width()/previewLarge.scaleTo(previewMedium),n=a.height()/previewLarge.scaleTo(previewMedium),a.width(i),a.height(n),a.css({"margin-left":(previewMedium.width-i)/2+"px","margin-top":(previewMedium.height-n)/2+"px"})}},rotate:function(e){var t,i=new Matrix(l.panzoom("getMatrix")),a=i.x(new Matrix(e)).toSource(),r=Math.abs(+a[0]?a[0]:a[1]);this.matrix(a),l.panzoom("setMatrix",a,{animate:!1}),l.panzoom("resetDimensions"),l.panzoom("setMatrix",a,{animate:!1}),n.call(this),t=new preview(f,m).getDefaultMatrix(l,!0)[0],l.panzoom("option","minScale",t),t>r&&l.panzoom("zoom",t)}},p),i.call(this),this}}(jQuery),Matrix.prototype={x:function(e){var t=e instanceof Vector,i=this.elements,n=e.elements;return t&&3===n.length?new Vector(i[0]*n[0]+i[1]*n[1]+i[2]*n[2],i[3]*n[0]+i[4]*n[1]+i[5]*n[2],i[6]*n[0]+i[7]*n[1]+i[8]*n[2]):n.length===i.length&&new Matrix(i[0]*n[0]+i[1]*n[3]+i[2]*n[6],i[0]*n[1]+i[1]*n[4]+i[2]*n[7],i[0]*n[2]+i[1]*n[5]+i[2]*n[8],i[3]*n[0]+i[4]*n[3]+i[5]*n[6],i[3]*n[1]+i[4]*n[4]+i[5]*n[7],i[3]*n[2]+i[4]*n[5]+i[5]*n[8],i[6]*n[0]+i[7]*n[3]+i[8]*n[6],i[6]*n[1]+i[7]*n[4]+i[8]*n[7],i[6]*n[2]+i[7]*n[5]+i[8]*n[8])},inverse:function(){var e=1/this.determinant(),t=this.elements;return new Matrix(e*(t[8]*t[4]-t[7]*t[5]),e*-(t[8]*t[1]-t[7]*t[2]),e*(t[5]*t[1]-t[4]*t[2]),e*-(t[8]*t[3]-t[6]*t[5]),e*(t[8]*t[0]-t[6]*t[2]),e*-(t[5]*t[0]-t[3]*t[2]),e*(t[7]*t[3]-t[6]*t[4]),e*-(t[7]*t[0]-t[6]*t[1]),e*(t[4]*t[0]-t[3]*t[1]))},determinant:function(){var e=this.elements;return e[0]*(e[8]*e[4]-e[7]*e[5])-e[3]*(e[8]*e[1]-e[7]*e[2])+e[6]*(e[5]*e[1]-e[4]*e[2])},toSource:function(){var e=this.elements;return[e[0],e[3],e[1],e[4],e[2],e[5]]}},Vector.prototype.e=Matrix.prototype.e=function(e){return this.elements[e]};var preview=function(e,t){this.width=e,this.height=t};preview.prototype.setImageURL=function(e,t,i,n){return i&&$(e).one("load",i),n&&$(e).one("error",n),$(e).attr("src",t),$(e)},preview.prototype.scaleTo=function(e){return this.width/e.width},preview.prototype.getDefaultMatrix=function(e,t){function i(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}var n=$(e)[0].width,a=$(e)[0].height,r=0,s=0,o=Math.min(Math.min(this.width/n,this.height/a),1);return t||(r=(o-1)*n/2,s=(o-1)*a/2),n*=o,a*=o,[i(o,6),0,0,i(o,6),i((this.width-n)/2+r,6),i((this.height-a)/2+s,6)]},preview.prototype.build=function(e,t,i,n,a){var r=new Image,s=this;this.setImageURL(r,e,function(){var e;t||(t=s.getDefaultMatrix(r,!0));var o=0,l=0,h=+t[4],c=+t[5];if(!i){var d=r.width/2,u=r.height/2;o=d+ +t[4],l=u+ +t[5],h=-(t[0]*d+t[2]*u),c=-(t[1]*d+t[3]*u)}s.newMatrix=[t[0],t[1],t[2],t[3],h+o,c+l],e=s.render({finalScale:n,matrix:s.newMatrix,image:r}),a.call(s,e)})},preview.prototype.getBinaryData=function(e,t,i,n,a){var r=this;this.build(e,t,i,n,function(e){a.call(r,base64decode(e[0].toDataURL("image/jpeg",1).replace(/^data:[a-z]*;,/,"")))})},preview.prototype.render=function(e){var t=$("<canvas>").attr({width:this.width,height:this.height}),i=t[0].getContext("2d");return i.setTransform(e.finalScale,0,0,e.finalScale,0,0),i.transform.apply(i,e.matrix),i.fillStyle="#ffffff",i.fillRect(0,0,e.image.width,e.image.height),i.drawImage(e.image,0,0),i.transform(1,0,0,1,0,0),t},preview.prototype.largeRender=function(e){function t(e){return Math.max(Math.abs(e[0]),Math.abs(e[1]))}var i=t(e.matrix),n=Math.abs(e.matrix[1]),a=this.width,r=this.height,s=n?e.image.height:e.image.width,o=n?e.image.width:e.image.height;i*s*e.finalScale<a&&(e.matrix[4]-=(a/e.finalScale-i*s)/2,a=i*s*e.finalScale),i*o*e.finalScale<r&&(e.matrix[5]-=(r/e.finalScale-i*o)/2,r=i*o*e.finalScale);var l=$("<canvas>").attr({width:a,height:r}),h=l[0].getContext("2d");return h.setTransform(e.finalScale,0,0,e.finalScale,0,0),h.transform.apply(h,e.matrix),h.fillStyle="#ffffff",h.fillRect(0,0,s,o),h.drawImage(e.image,0,0),h.setTransform(1,0,0,1,0,0),l};var previewSmall=new preview(86,68),previewMedium=new preview(340,272),previewLarge=new preview(770,616),previewSquareSmall=new preview(86,86),previewSquareMedium=new preview(330,330),previewSquareLarge=new preview(700,700),previewPosterShowSmall=new preview(86,56),previewPosterShowMedium=new preview(450,300),previewPosterShowLarge=new preview(450,300),previewPosterVenue=new preview(180,120),previewTVChannel=new preview(40,32),previewPosterHallPlanSmall=new preview(96,96),previewPosterHallPlanLarge=new preview(660,660),previewNewsLarge=new preview(660,440),previewMobile=new preview(120,96),previewMobileLarge=new preview(770,616),previewLogo=new preview(300,115),previewLogoLarge=new preview(300,115);previewSquareLarge.render=function(e){return this.largeRender.call(this,e)},previewPosterShowLarge.render=function(e){return this.largeRender.call(this,e)},previewPosterHallPlanLarge.render=function(e){return this.largeRender.call(this,e)},previewNewsLarge.render=function(e){return this.largeRender.call(this,e)},previewLarge.render=function(e){return this.largeRender.call(this,e)},previewLogoLarge.render=function(e){return this.largeRender.call(this,e)},previewPosterVenue.render=function(e){return this.largeRender.call(this,e)},previewTVChannel.render=function(e){return this.largeRender.call(this,e)},previewMobileLarge.render=function(e){return this.largeRender.call(this,e)},function(e){e.fn.uploaderThumbnail=function(t){function i(){this.addClass("image"),a.call(this),r.call(this),s.call(this)}function n(){this.addClass("image"),this.css({overflow:"hidden"}),a.call(this),s.call(this)}function a(){if(this.supported){var t=e("<div>").css({overflow:"hidden",width:0,height:0});o=e("<img>"),t.append(o),this.append(t)}else o=e("<img>"),this.append(o)}function r(){this.append(e("<div></div>").addClass("hint--bottom").attr("data-hint","Удалить").append(e("<div></div>").addClass("delete"))),this.isMobile||this.isLogo||this.append(e("<div></div>").addClass("default").html("<span>главное фото</span>")).append(e("<div></div>").addClass("isDefault")),this.defaultImage(d)}function s(){var t=this;e(this).click(function(){t.clickCallback()}),e(".delete",this).click(function(){t.deleteCallback.call(t)}),e(".default",this).click(function(){t.setDefaultCallback.call(t)})}var o,l,h,c,d=!1,u="",f=!1,m=e.extend({deleteCallback:function(){},setDefaultCallback:function(){},apiURI:"",preset:"ads",imageURL:function(e){return e},supported:!0,isMobile:!1,isLogo:!1},t);return e.extend(this,{filename:function(t,i){var n=this;return"undefined"==typeof t?u.toString():(u=t,this.isImageURLLocal(u)?f=!0:u=this.imageURL(u),l||(l=u),preview.prototype.setImageURL(o,u,function(){if(!c){var e;switch(n.preset){case"logo":case"logo-mrkt":case"Logo":case"MarketLogo":e=previewLogo;break;case"AdCommon":case"AdResume":case"MarketProduct":case"PosterHallPlan":e=previewSquareMedium;break;case"PosterShow":case"News":e=previewPosterShowMedium;break;case"PosterVenue":e=previewPosterVenue;break;case"TVChannel":e=previewTVChannel;break;default:e=previewMedium}c=e.getDefaultMatrix(o,!1),n.matrix(c),n.fit()}i&&i()},function(){n.removeClass("loading").addClass("errorLoading"),n.unbind("click"),e(".default",n).unbind("click"),e(".default span",n).html("")}))},image:function(e){return"undefined"==typeof e?o:(o.remove(),o=e,this.append(o),o)},matrix:function(e){return"undefined"==typeof e?h:(h&&(f=!0),h=e,o)},isModified:function(){return f},initialMatrix:function(){return c},defaultImage:function(t){return"undefined"==typeof t?d:(d=!!t,e(".default",this).toggle(!d),e(".isDefault",this).toggle(d),this)},fit:function(){var e,t,i=this;switch(i.preset){case"logo":case"logo-mrkt":case"Logo":case"MarketLogo":e=t=previewLogo;break;case"mobile":e=previewMobile,t=previewMedium;break;case"AdCommon":case"AdResume":case"MarketProduct":e=previewSquareSmall,t=previewSquareMedium;break;case"PosterShow":case"News":e=previewPosterShowSmall,t=previewPosterShowMedium;break;case"PosterHallPlan":e=previewPosterHallPlanSmall,t=previewSquareMedium;break;case"PosterVenue":e=t=previewPosterVenue;break;case"TVChannel":e=t=previewTVChannel;break;default:e=previewSmall,t=previewMedium}if(i.isMobile&&(e=previewMobile,t=previewMedium),"undefined"!=typeof window.HTMLCanvasElement)e.build(this.filename(),this.matrix(),!1,e.scaleTo(t),function(e){i.image(e),i.removeClass("loading")});else{var n=i.image(),a=n.width()/previewLarge.scaleTo(e),r=n.height()/previewLarge.scaleTo(e);n.width(a),n.height(r),n.css({"margin-left":(e.width-a)/2+"px","margin-top":(e.height-r)/2+"px"}),i.removeClass("loading")}},isImageURLLocal:function(e){return!!e.match(/^data/)||!e},send:function(t,i,n,a){function r(e){return e.match(/\/(.*)$/)[1]}function s(e){var t,i=new FileReader;"undefined"!=typeof i.readAsBinaryString?(i.readAsBinaryString(e),i.onloadend=function(){l(i.result,e.type)}):(i.readAsDataURL(e),i.onloadend=function(){t=base64.decode(i.result.replace(/^(.*?base64,)/,"")),l(t,e.type)})}function o(e){var t=base64.decode(e.replace(/^(.*?base64,)/,"")),i=e.match(/^.*?:(.*?);/)[1];l(t,i)}function l(e,t){var i="1BEF0A57BE110FD467A",n="--"+i,a=n+"\r\n";u.open("POST",d.apiURI+"/binary/",!0),a+='Content-Disposition: form-data; name="preset"\r\n\r\n'+d.preset+"\r\n"+n+"\r\n",a+='Content-Disposition: form-data; name="uploadedImages"; filename="1.'+r(t)+'"\r\nContent-Type: '+t+"\r\n\r\n"+e+"\r\n"+n,u.setRequestHeader("Content-type",'multipart/form-data; boundary="'+i+'"'),c(u,a)}function h(){var t=d.filename().match(/^.*\/(.*)$/)[1],n="1BEF0A57BE110FD467A",a="--"+n,r=a+"\r\n";u.open("POST",d.apiURI+"/server/",!0),e.each(i,function(e,t){r+='Content-Disposition: form-data; name="transform['+e+']"\r\n\r\n'+t+"\r\n"+a+"\r\n"}),r+='Content-Disposition: form-data; name="preset"\r\n\r\n'+d.preset+"\r\n"+a+"\r\n",r+='Content-Disposition: form-data; name="fileName"; \r\n\r\n'+t+"\r\n"+a+"\r\n",u.setRequestHeader("Content-type",'multipart/form-data; boundary="'+n+'"'),c(u,r)}function c(e,t){try{"undefined"==typeof XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t,0),n=0;n<e.length;n++)i[n]=255&e.charCodeAt(n);this.send(i)}),e.sendAsBinary(t)}catch(i){e.send(t)}}var d=this,u=new XMLHttpRequest;if(u.onload=function(){var e=JSON.parse(this.response);e.success?(d.filename(e.fileName),n&&n.call(this)):(alert(e.errorMessage.join("\n")),a&&a.call(this))},u.onerror=function(){alert("Ошибка связи с сервером")},!this.isImageURLLocal(this.filename()))return void h();try{t[0].toBlob(function(e){s(e)},"image/jpeg",1)}catch(e){var f=t[0].toDataURL();o(f)}},save:function(e,t){var i,n,a=this;switch(a.preset){case"logo":case"logo-mrkt":case"Logo":case"MarketLogo":i=previewLogoLarge,n=previewLogo;break;case"AdCommon":case"AdResume":case"MarketProduct":i=previewSquareLarge,n=previewSquareMedium;break;case"PosterShow":i=previewPosterShowLarge,n=previewPosterShowMedium;break;case"PosterHallPlan":i=previewPosterHallPlanLarge,n=previewSquareMedium;break;case"PosterVenue":i=n=previewPosterVenue;break;case"News":i=previewNewsLarge,n=previewPosterShowMedium;break;case"TVChannel":i=n=previewTVChannel;break;default:i=previewLarge,n=previewMedium}a.isMobile&&(i=previewMobileLarge,n=previewMedium),i.build(this.filename(),this.matrix(),!1,i.scaleTo(n),function(i){a.send(i,this.newMatrix,function(){e&&e.call(this),f=!1,c=a.matrix()},t)})}},m),this.supported?i.call(this):n.call(this),this}}(jQuery),function(e){e.fn.imageUploader=function(t){function i(t){var i=t.onProgress,n=t.onComplete,a=t.onError,r=l.getModifiedImages(),s=this,o=0,h=r.length;h?e.each(r,function(){this.save(function(){o++,i&&i.call(s,o,h),o==h&&n&&n.call(s)},function(){a&&a.call(s)})}):n&&n.call(s)}function n(){var t,i,n,r=e('<input id="files" type="file" accept= "image/*" multiple="true">'),s=this;r.appendTo(s);var o=function(e,a){return function(r){var s=r.target.result;"undefined"!=typeof e.verifiedType&&e.verifiedType&&(s=setMimeTypeInRawDataURL(s,e.verifiedType)),s.match(/^data:image/)?a.add(s):i.push(e.name),n==++t&&i.length&&alert([].concat(["Файл(ы):",i.join("\n"),"","имеют недопустимый формат."]).join("\n"))}};r.click(function(){e(this).val("")}),r.change(function(){if(t=0,i=[],n=this.files.length)for(var e,a=0;e=this.files[a];a++)if(e.type){var r=new FileReader;r.onloadend=function(e){return o(e,s)}(e),r.readAsDataURL(e)}else{var l=new FileReader;l.onloadend=function(e){return function(t){e.verifiedType=mimeFromArrayBuffer(t.target.result);var i=new FileReader;i.onloadend=function(e){return o(e,s)}(e),i.readAsDataURL(e)}}(e),l.readAsArrayBuffer(e)}}),a.call(this,r)}function a(t){function i(){return location.host.match(/\.by/)?"/помощь/293/61/":"/помощь/335/61/"}var n,a,r;switch(a=e("<div>").addClass("requirements"),a.html('<a href="'+i()+'" target="_blank">Требования к изображениям</a>'),n=e("<div>").attr({id:"download"}),n.click(function(){t.click()}),!0){case this.isMobile:if(this.maxImages>1){var s=e("<div>").addClass("restrictions");s.text("Максимально 8 фото"),this.append(s),this.append(a),n.text("Загрузить").css({display:"none"}),d.append(n)}else r=e("<div></div>").addClass("oneImageBlock"),n.text("Загрузить"),r.append(n).append(a),this.append(r);break;case this.isLogo:n.text("Загрузить логотип"),this.prepend(a).prepend(n);break;default:"TVChannel"==this.preset?n.text("Загрузить"):n.text("Загрузить фото"),a=e("<div>").addClass("requirements"),a.html('<a href="'+i()+'" target="_blank">Требования к изображениям</a>'),e.inArray(this.preset,["News","PosterHallPlan"])>-1?l.append(n):d.append(n),e.inArray(this.preset,["PosterShow","News","PosterHallPlan","PosterVenue","TVChannel"])==-1&&d.append(a),"AdResume"!=this.preset&&1!=this.maxImages||(l.addClass("notVisible"),a.addClass("notVisibleList"))}}function r(){switch(this.preset){case"AdCommon":case"MarketProduct":this.addClass("squareImageUploader");break;case"AdResume":this.addClass("resumeUploader");break;case"PosterShow":this.addClass("posterShowUploader");break;case"PosterHallPlan":this.addClass("posterHallPlanUploader");break;case"PosterVenue":this.addClass("posterVenueUploader");break;case"News":this.addClass("newsUploader");break;case"TVChannel":this.addClass("tvUploader");break;case"Logo":case"MarketLogo":this.addClass("newLogoUploader")}}function s(){r.call(this);var t=.1;if(this.isMobile||this.isLogo||(c=e("<div></div>").uploaderMainImage({imageURL:this.imageURL,preset:this.preset}),this.append(c)),l=e("<div></div>").uploaderImageList({$mainImage:c,maxImages:this.maxImages,imageURL:this.imageURL,apiURI:this.apiURI,preset:this.preset,isMobile:this.isMobile,isLogo:this.isLogo}),this.append(h),this.append(l),n.call(this),!this.isMobile&&!this.isLogo){e("img",c).panzoom({$zoomIn:e(".increaseImg",c),$zoomOut:e(".decreaseImg",c),startTransform:"scale(1)",increment:t,minScale:1,contain:"invert"});var i=c.find("img").panzoom({contain:"invert"});i.parent().on("mousewheel.focal",function(e){e.preventDefault();var n=e.delta||e.originalEvent.wheelDelta,a=n?n<0:e.originalEvent.deltaY>0,r=e.shiftKey?t/4:t;i.panzoom("zoom",a,{increment:r,animate:!0,focal:e})})}}function o(){this.isMobile||this.isLogo||(c=e("<div></div>").uploaderMainImage({imageURL:this.imageURL,supported:!1,preset:this.preset}),l=e("<div></div>").uploaderImageList({$mainImage:c,maxImages:this.maxImages,imageURL:this.imageURL,supported:!1}),this.append(c)),this.append(l),this.append(e("<div>").addClass("warning").html('<div class="heading">Уважаемый пользователь!</div><div class="text">Ваш браузер устарел. Для корректной загрузки фото обновите версию браузера.</div>'))}var l,h,c=null,d=this;this.apiURI="",this.isMobile=!1,this.isLogo=!1,this.preset="ads",this.maxImages=8,this.imageURL=function(e){return e};var u=function(){return"undefined"!=typeof FileReader};return this.add=function(e){return e&&l.add(e),this},this.save=function(e){this.isMobile||this.isLogo||c.applyModified(c.thumbnail()),i.apply(this,arguments)},this.clearImages=function(){return l.empty(),this},this.getImageFilenames=function(e){return l.getImageFilenames(e)},this.getModifiedImages=function(){return l.getModifiedImages()},this.defaultImage=function(e){l.defaultImage(e)},e.extend(this,t),u()?s.call(this):o.call(this),this}}(jQuery);